









<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  
 <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
 
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
        
        
    <title>EMIIA.AI MRV: SDK/API - em_70.3388_675_it_98342234...</title>    
        

	
	<link rel="manifest" href="manifest.json">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="application-name" content="EMIIA.AI MRV">
<meta name="apple-mobile-web-app-title" content="EMIIA.AI MRV">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#fff">
<meta name="msapplication-starturl" content="https://www.emiia.ai/indoor15.html">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
	
	
	
	<link rel="manifest" href="/manifest.json">
	
	<script src="https://js.sentry-cdn.com/9c5feb5b248b49f79a585804c259febc.min.js" crossorigin="anonymous"></script>
	
	
	
    
    
    
    
    
    <style>
@import url('https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

	<style>
@import url('https://www.emiia.ru/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

  <style>  
@import url('/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

<link rel="stylesheet" href="https://www.emiia.ru/cssfamily=Montserrat.css">
<link rel="stylesheet" href="/cssfamily=Montserrat.css">

    
    
  
	
	
	
    



















        
	

    

 
              
              
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>

    
    
    
    
    <script src="https://www.emiia.ai/geocoderemiia.js"></script>
    
    <script src="/geocoderemiia.js"></script>
    
    
    
    <script src="https://github.com/map-gl-indoor/map-gl-indoor/releases/download/v0.2.0/map-gl-indoor.umd.js"></script>

    <link href="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css" rel="stylesheet" />
    

        
        
        
        
    
        
        
        
        <script src='https://mapbox.github.io/mapbox-gl-traffic/mapbox-gl-traffic.js'></script>

    
    
    
    
    <link href='https://mapbox.github.io/mapbox-gl-traffic/mapbox-gl-traffic.css' rel='stylesheet' />
    
     <link href='https://www.emiia.ai/geocoderemiia.css' rel='stylesheet' />
     
     <link href='/geocoderemiia.css' rel='stylesheet' />
     
     
     
     
     
     
     
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
     
     
     

     
     
        
    
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
        }
        
        
      
        
    </style>
    
    
    
    
    
    
    
    
    
    
    
    
        
         <script src="https://www.emiia.ai/indoornav.js"></script>  
         
         
         <script src="/indoornav.js"></script>  
         
         
         <link rel="stylesheet" href="https://www.emiia.ai/indoornav.css">
         
             <link rel="stylesheet" href="/indoornav.css">
         
         
       

  
    
    <style>
        /* Mapbox GL */
.mapboxgl-ctrl-top-right .mapboxgl-ctrl {
  margin: 12px 12px 0 0 !important;
}
.mapboxgl-ctrl-icon {
  background-size: 18px 18px !important;
  background-position: 6px 6px !important;
  background-repeat: no-repeat !important;
}
.mapboxgl-ctrl-icon.mapboxgl-ctrl-compass > .mapboxgl-ctrl-compass-arrow {
  height: 18px;
  margin: 6px;
  width: 18px;
  background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='yes'%3F%3E%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 18 18'%3E%3Cpath fill='%231F3044'%0Ad='M5.5,14.2c-0.9,0.8-1.9,0-1.5-1l4-9c0.2-0.4,0.6-0.8,1-0.8s0.8,0.4,1,0.8l4,9c0.4,1-0.6,1.8-1.5,1l-3.5-3L5.5,14.2z'/%3E%3C/svg%3E");
}
.mapboxgl-ctrl-group {
  box-shadow: 0 0 10px 2px rgba(0, 0, 0, 0.1) !important;
}

/* only hide the logo if title=true is true */
.has-title .mapboxgl-ctrl-logo {
  display: none !important;
}



















@media only screen and (max-width: 640px) {
  .mapbox-mark {
    width: 30px;
  }
  
  
  
  .infobox-action {
    display: none;
  }
  
  
  
 
  
  

}






        </style>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <style>
#marker {
background-image: url('https://www.emiia.ai/emiia143.1.3.svg');
background-size: cover;
width: 110px;  height: 48px;
border-radius: 0%;
cursor: pointer;
}
 
.mapboxgl-popup {
max-width: 200px;
}





</style>
    
    
    
    
    
    
    

    
    
    
    
    
    
</head>

<body>
    <div id="map"></div>
    
    

    
    

    <script>
    
    
    const monument = [  37.17403560876846,55.977308625119825];
    
        mapboxgl.accessToken = 'pk.eyJ1IjoiZW1paWFhaSIsImEiOiJja21icnU4bHkyNGRwMnFrbjVvNXdtdGJ0In0.TcfxV21Ov7zOgvWvgPxzlA'
        const map = window.map = new mapboxgl.Map({
            container: "map",
            zoom: 18,
            center: [37.174014151096344,
              55.97747745943937],
            style: 'mapbox://styles/mapbox/streets-v10',
             attributionControl: false,
            hash: true
        });
        
        
        
        
        
       
      

        /**
         * Indoor specific
         */

        // Where the indoor layers will be inserted.
        // Here, 'housenum-label' comes from streets-v10
        const beforeLayerId = 'housenum-label';

        // To avoid unwanted overlap from streets-v10 layers, some layers are hidden when an indoor map is shown
        const layersToHide = ['poi-scalerank4-l15', 'poi-scalerank4-l1', 'poi-scalerank3', 'road-label-small'];

        var customData;

        // Retrieve the geojson from the path and add the map
        fetch('https://www.emiia.ru/ofisgeojson8.geojson')
            .then(res => res.json())
            .then(geojson => {
                map.indoor.addMap(mapgl_indoor.IndoorMap.fromGeojson(geojson, { beforeLayerId, layersToHide }));
                customData = geojson;
            });

            function forwardGeocoder(query) {
            var matchingFeatures = [];

            for (var i = 0; i < customData.features.length; i++) {
                var feature = customData.features[i];
                if (feature.properties.hasOwnProperty('name') &&
                    feature.properties['name']
                        .toLowerCase()
                        .search(query.toLowerCase()) !== -1
                ) {
                    feature['place_name'] = feature.properties['name'];
                    feature['center'] = turf.centroid(feature).geometry.coordinates;
                    feature['place_type'] = ['park'];
                    matchingFeatures.push(feature);
                } else if (feature.properties.hasOwnProperty('name') &&
                    feature.properties.name
                        .toLowerCase()
                        .search(query.toLowerCase()) !== -1
                ) {
                    feature['place_name'] = feature.properties.name;
                    feature['center'] = turf.centroid(feature).geometry.coordinates;
                    feature['place_type'] = ['park'];
                    matchingFeatures.push(feature);
                }
            }
            return matchingFeatures;
        }
        let geocoder = new MapboxGeocoder({
            localGeocoderOnly: true,
            localGeocoder: forwardGeocoder,
            zoom: 19,
            placeholder: '\u00A0 Search/Navigation Indoor',
            
            
           
 
            
            mapboxgl: mapboxgl,
            marker: true,
        });
        geocoder.on("result", (result) => {
            console.log('result.result.properties:', result.result.properties);
            map.indoor.setLevel(parseInt(result.result.properties.level));
        })
       
       
       
       
       
     
     
     
  
  
  
  
  
     
       
       
       
        // МЕСТО ГЕОКОДЕРА.
       
       
       
       
       
   
   
   
   
   
   
       
       
       

        // Add zoom and rotation controls to the map.
        map.addControl(new mapboxgl.NavigationControl(), 'top-right');

        // Add the specific control
        map.addControl(map.indoor.control, 'bottom-left');
        
        
(new mapboxgl.NavigationControl());

(new mapboxgl.GeolocateControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
}));













const geolocate = new mapboxgl.GeolocateControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
});



map.addControl(geolocate, 'top-right');
    

map.addControl(new MapboxTraffic());










var scale = new mapboxgl.ScaleControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
});






      const directions = new MapboxDirections({
        accessToken: mapboxgl.accessToken,
        steps: false,
        geometries: 'polyline',
        controls: { instructions: false }
      });

      map.addControl(directions, 'top-left');

      // After the map style has loaded on the page, add a source layer and default
      // styling for a single point.
      map.on('load', () => {
        // Listen for the `directions.route` event that is triggered when a user
        // makes a selection and add a symbol that matches the result.
        directions.on('route', (event) => {
          const styleSpecBox = document.getElementById('json-response');
          styleSpecBox.innerHTML = `${syntaxHighlight(
            JSON.stringify(event.route, null, 2)
          )}`;
        });
      });

      function syntaxHighlight(json) {
        json = json
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
        return json.replace(
          /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,
          (match) => {
            let cls = 'number';
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = 'key';
              } else {
                cls = 'string';
              }
            } else if (/true|false/.test(match)) {
              cls = 'boolean';
            } else if (/null/.test(match)) {
              cls = 'null';
            }
            return `<span class="${cls}">${match}</span>`;
          }
        );
      }
  





        

    </script>
    
    
    
    
    
    
    
    
    
<script>  
    
    // create the popup
const popup = new mapboxgl.Popup({ offset: 25 })
   .setHTML("<iframe top:0;left:0;position:absolute;  allowfullscreen:true; width=335 height=500  frameborder='0'   src=https://www.emiia.ai/mrv.html?token=2.GtErfHCeAAcABc_H50WdWnkWZhJog9K6RBpaBlvUD9zSiDCX&amp;camera=0&amp;width=&amp;height=&amp;lang=ru frameborder=0 allow=accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture allowfullscreen></iframe>")
   

// create DOM element for the marker
var el = document.createElement('div');
el.id = 'marker';
 
// create the marker
new mapboxgl.Marker(el)
.setLngLat(monument)
.setPopup(popup) // sets a popup on this marker
.addTo(map);

    
 </script>    
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.9/css/weather-icons.min.css'>


  
  
  

<style>
  #demo {





@import url('https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');



@import url('https://www.emiia.ru/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');


  
@import url('/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');


<link rel="stylesheet" href="https://www.emiia.ru/cssfamily=Montserrat.css">
<link rel="stylesheet" href="/cssfamily=Montserrat.css">


  color: #383838;

  font-size: 12px;

font-weight:400;


position: absolute;
bottom: 3%;
left: 0rem;
 cursor: pointer;


   
  left: 1.3rem;
  -webkit-transform: translateY(-0%);
  -ms-transform: translateY(-0%);
  transform: translateY(-0%);float:left}





position: absolute;
bottom: 0%;
left: 0rem;



 

  }
</style>





  
  <section id="demo" >
  
  
  
  


        
        
        <div style="overflow: hidden;">
        
        
        
          <div style="float: left; width: 35px; height: 10px;"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
  </svg> <span class="ow-pressure1"></span></div> 
  

  
  
  
  
    
            <div style="float: left; width: 25px; height: 17px; font-size: 14px;" class="wi ow-ico ow-ico-current pull-left"></div>
                        <div style="float: left; width: 29.5px; height: 10px; " class="ow-temp-current pull-left"></div>
                        
                        
                        
  
               

            

    
                   <div style="float: left; width: 80px; height: 10px;"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-speedometer2" viewBox="0 0 16 16">
  <path d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z"/>
  <path fill-rule="evenodd" d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A7.988 7.988 0 0 1 0 10zm8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3z"/>
</svg> <span class="ow-pressure"></span></div>  





                <div style="float: left; width: 53px; height: 10px;"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-droplet" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M7.21.8C7.69.295 8 0 8 0c.109.363.234.708.371 1.038.812 1.946 2.073 3.35 3.197 4.6C12.878 7.096 14 8.345 14 10a6 6 0 0 1-12 0C2 6.668 5.58 2.517 7.21.8zm.413 1.021A31.25 31.25 0 0 0 5.794 3.99c-.726.95-1.436 2.008-1.96 3.07C3.304 8.133 3 9.138 3 10a5 5 0 0 0 10 0c0-1.201-.796-2.157-2.181-3.7l-.03-.032C9.75 5.11 8.5 3.72 7.623 1.82z"/>
  <path fill-rule="evenodd" d="M4.553 7.776c.82-1.641 1.717-2.753 2.093-3.13l.708.708c-.29.29-1.128 1.311-1.907 2.87l-.894-.448z"/>
</svg> <span class="ow-humidity"></span></div>

<div style="float: left; width: 80px; height: 10px;"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-wind" viewBox="0 0 16 16">
  <path d="M12.5 2A2.5 2.5 0 0 0 10 4.5a.5.5 0 0 1-1 0A3.5 3.5 0 1 1 12.5 8H.5a.5.5 0 0 1 0-1h12a2.5 2.5 0 0 0 0-5zm-7 1a1 1 0 0 0-1 1 .5.5 0 0 1-1 0 2 2 0 1 1 2 2h-5a.5.5 0 0 1 0-1h5a1 1 0 0 0 0-2zM0 9.5A.5.5 0 0 1 .5 9h10.042a3 3 0 1 1-3 3 .5.5 0 0 1 1 0 2 2 0 1 0 2-2H.5a.5.5 0 0 1-.5-.5z"/>
</svg> <span class="ow-wind"></span></div>
            </div>
            
            
            
            

       
                

</section>

  

  
  
  <script>

'use strict';

let weatherWidget = {
    settings: {
        api_key: '6bd5b850178e2134497c4b965fbaf54e',
        weather_url: 'https://api.openweathermap.org/data/2.5/weather',
        forecast_url: 'https://api.openweathermap.org/data/2.5/forecast',
        search_type: 'city_name',
        city_name: '',
        units: 'metric',
        icon_mapping: {
            '01d': 'wi-day-sunny',
            '01n': 'wi-day-sunny',
            '02d': 'wi-day-cloudy',
            '02n': 'wi-day-cloudy',
            '03d': 'wi-cloud',
            '03n': 'wi-cloud',
            '04d': 'wi-cloudy',
            '04n': 'wi-cloudy',
            '09d': 'wi-rain',
            '09n': 'wi-rain',
            '10d': 'wi-day-rain',
            '10n': 'wi-day-rain',
            '11d': 'wi-thunderstorm',
            '11n': 'wi-thunderstorm',
            '13d': 'wi-snow',
            '13n': 'wi-snow',
            '50d': 'wi-fog',
            '50n': 'wi-fog'
        }
    },
    constant: {
        dow: ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT']
    }
};

weatherWidget.init = function (settings) {
    this.settings = Object.assign(this.settings, settings);
    Promise.all([this.getWeather(), this.getForecast()]).then((resolve) => {
        let weather = resolve[0];
        let forecast = resolve[1].list;

        //@TODO lokalizacja bez zwrotki, blad


        document.getElementsByClassName('ow-temp-current')[0].innerHTML = Math.round(weather.main.temp) + '&deg';
        document.getElementsByClassName('ow-pressure')[0].innerHTML = weather.main.pressure + ' hPa';
        document.getElementsByClassName('ow-humidity')[0].innerHTML = weather.main.humidity + '%';
        document.getElementsByClassName('ow-wind')[0].innerHTML = weather.wind.speed + ' km/h';
        if (!!this.settings.icon_mapping[weather.weather[0].icon]) {
            let icon = this.settings.icon_mapping[weather.weather[0].icon];
            let ico_current =  document.getElementsByClassName('ow-ico-current')[0];
            if (ico_current.classList) {
                ico_current.classList.add(icon);
            } else {
                ico_current.className += ' ' + icon;
            }

        }

        // split forecast data by day
        // get max and min temperature for a day
        //@TODO get average forecast by day

        // remove todays weather from forecast
        forecast = forecast.filter((x) => {
            return x.dt_txt.substr(0, 10) !== new Date().toJSON().slice(0, 10);
        });

        // array to hold forecast items
        let fs = [];for (let f of forecast) {
            let date = f.dt_txt.substr(0, 10);
            if (!!fs[date]) {
                fs[date].temp_max = f.main.temp_max > fs[date].temp_max ? f.main.temp_max : fs[date].temp_max;
                fs[date].temp_min = f.main.temp_min < fs[date].temp_min ? f.main.temp_min : fs[date].temp_min;
                fs[date].icons.push(f.weather[0].icon);
            } else {
                fs[date] = {
                    dow: this.constant.dow[new Date(date).getDay()],
                    temp_max: f.main.temp_max,
                    temp_min: f.main.temp_min,
                    icons: [f.weather[0].icon]
                }
            }
        }

        let forecast_items = document.getElementsByClassName('ow-forecast-item');

        // for each daily forecast, get weather icon with highest occurence
        // show the foreacast
        let counter = 0;
        for (let day in fs) {
            let icon = this.settings.icon_mapping[this.getIconWithHighestOccurence(fs[day].icons)];
            let fi = forecast_items[counter];
            fi.getElementsByClassName('max')[0].innerHTML = Math.round(fs[day].temp_max) + '&deg';
            fi.getElementsByClassName('min')[0].innerHTML = Math.round(fs[day].temp_min) + '&deg';
            fi.getElementsByClassName('ow-day')[0].innerHTML = fs[day].dow;
            let ico_current =  fi.getElementsByClassName('ow-ico-forecast')[0];
            if (ico_current.classList) {
                ico_current.classList.add(icon);
            } else {
                ico_current.className += ' ' + icon;
            }
            counter++;
        }

    });
};

weatherWidget.getForecast = function () {
    let params = {
        'q': this.settings.city_name,
        'APPID': this.settings.api_key,
        'units': this.settings.units
    };

    let p = '?' + Object.keys(params)
            .map((key) => {
                return key + '=' + params[key]
            })
            .join('&');
    return this.makeRequest(this.settings.forecast_url, p);
};

weatherWidget.getWeather = function () {
    let params = {
        'q': this.settings.city_name,
        'APPID': this.settings.api_key,
        'units': this.settings.units
    };

    let p = '?' + Object.keys(params)
            .map((key) => {
                return key + '=' + params[key]
            })
            .join('&');
    return this.makeRequest(this.settings.weather_url, p);
};

weatherWidget.makeRequest = function (url, params) {
    return new Promise(function (resolve, reject) {
        let req = new XMLHttpRequest();
        req.open('GET', url + params, true);
        req.responseType = 'json';

        req.onload = function () {
            if (req.status >= 200 && req.status < 400) {
                resolve(req.response);
            } else {
                reject(Error(req.status));
            }
        };

        req.onerror = () => reject('Error occured while connecting to Weather API');
        req.send(params);
    });
};

weatherWidget.getIconWithHighestOccurence = function (a) {
    let elems = Array.prototype.slice.call(a);
    return elems.sort((a, b) =>
        elems.filter(v => v === a).length - elems.filter(v => v === b).length
    ).pop();
}

// run the widget
let widget = Object.create(weatherWidget);
widget.init({
  city_name: 'Moscow'
});
  </script>
 
 
 
 
 
 
 
 
 
 
 
 
    
    
    
    
    
    

</body>

</html>












